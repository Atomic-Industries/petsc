#!/bin/csh
# $Id: buildntdist,v 1.37 1999/04/13 20:54:01 balay Exp balay $ 
# 

if ($#argv == 1) then
  set version=$1
  echo "Building ~/petscnt$version.tar.gz"
else
  set version=""
endif
#
# If /sandbox/petsc/tmp does not exist create it.
#
set tmpdir = "/sandbox/petsc/tmp"
if (! -d $tmpdir) then
  mkdir -p $tmpdir
endif
if (! -d $tmpdir) then
  echo 'Cannot create $tmpdir. Exiting..'
endif


/bin/rm -r -f $tmpdir/petscnt
/bin/rm -f $tmpdir/petscnt.tar
setenv PETSC_DIR /home/bsmith/petsc
cd /home/bsmith/petsc
make ACTION=clean tree

cd /home/bsmith
tar cFFXf /home/bsmith/petsc/maint/xclude $tmpdir/petscnt.tar petsc

#
#   Gets the C version of BLAS and LAPACK (these are excluded by the 
#   regular PETSc distribution hence we need to tar them up seperately
#
cd /home/bsmith/petsc/src
tar cFFXf /home/bsmith/petsc/maint/xcludecblas $tmpdir/cblas.tar blaslapack


mkdir $tmpdir/petscnt
cd $tmpdir/petscnt
tar xf $tmpdir/petscnt.tar

cd $tmpdir/petscnt/petsc/src
tar xf $tmpdir/cblas.tar

cd $tmpdir/petscnt/petsc
/bin/rm -rf bin
find $tmpdir/petscnt -type d -name output -exec /bin/rm -rf {} \;
/bin/rm -rf bmake/alpha* bmake/sun4* bmake/solaris* bmake/hpux 
/bin/rm -rf bmake/paragon bmake/rs6000* bmake/freebsd* bmake/linux 
/bin/rm -rf bmake/nt_gnu bmake/t3d bmake/t3e bmake/IRIX* bmake/i386*
/bin/rm -f  bmake/common. bmake/common bmake/ascired*
/bin/rm -rf src/blaslapack/examples

#
# Build the tag files
#
cd $tmpdir/petscnt/petsc
make etags etags_examples TAGSDIR=`pwd`
/bin/cp -f bmake/win32/makefile.dos makefile

cd $tmpdir/petscnt
chmod -R u+w petsc
/home/bsmith/petsc/maint/makecpp.tcl $tmpdir/petscnt/petsc

/bin/rm -f $tmpdir/petscnt.tar $tmpdir/cblas.tar


cd $tmpdir/petscnt
if ($#argv == 1) then
  mv petsc petsc$version
endif

tar cf $tmpdir/petscnt$version.tar petsc$version
cd ~/
/bin/rm -r -f $tmpdir/petscnt

gzip -f $tmpdir/petscnt$version.tar
/bin/cp $tmpdir/petscnt$version.tar.gz ~/
chmod ug+w ~/petscnt$version.tar.gz 
/bin/rm -f $tmpdir/petscnt$version.tar.gz
