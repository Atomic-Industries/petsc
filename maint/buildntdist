#!/bin/csh
# $Id: buildntdist,v 1.15 1998/04/23 23:56:04 balay Exp balay $ 
# 

if ($#argv == 1) then
  set version=$1
  echo "Building ~/petscnt$version.tar"
else
  set version=""
endif

/bin/rm -r -f /mcs/tmp/petscnt
/bin/rm -f /mcs/tmp/petscnt.tar
cd /home/bsmith/petsc
make ACTION=clean tree

cd /home/bsmith
tar cFFXf /home/bsmith/petsc/maint/xclude /mcs/tmp/petscnt.tar petsc

cd /home/bsmith/petsc/src
tar cFFXf /home/bsmith/petsc/maint/xcludecblas /mcs/tmp/cblas.tar adic


mkdir /mcs/tmp/petscnt
cd /mcs/tmp/petscnt
tar xf /mcs/tmp/petscnt.tar

cd /mcs/tmp/petscnt/petsc/src
tar xf /mcs/tmp/cblas.tar
mv  adic blaslapack

cd /mcs/tmp/petscnt/petsc
/bin/rm -rf bin
find /mcs/tmp/petscnt -type d -name output -exec /bin/rm -rf {} \;
/bin/rm -rf bmake/alpha* bmake/sun4* bmake/solaris* bmake/hpux bmake/t3d bmake/t3e
/bin/rm -rf bmake/paragon bmake/rs6000* bmake/freebsd* bmake/linux bmake/IRIX*

cd /mcs/tmp/petscnt
chmod -R u+w petsc
/home/bsmith/petsc/maint/makecpp.tcl /mcs/tmp/petscnt/petsc

/bin/rm -f /mcs/tmp/petscnt.tar /mcs/tmp/cblas.tar
if ($#argv == 1) then
  mv petsc petsc$version
endif

tar cf /mcs/tmp/petscnt$version.tar petsc$version
cd ~/
/bin/rm -r -f /mcs/tmp/petscnt

gzip /mcs/tmp/petscnt$version.tar
/bin/cp /mcs/tmp/petscnt$version.tar.gz ~/
chmod ug+w ~/petsc.tar.gz
/bin/rm -f /mcs/tmp/petscnt$version.tar.gz