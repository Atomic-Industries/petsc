#!/bin/csh
# $Id: buildntdist,v 1.33 1999/02/04 19:34:40 balay Exp balay $ 
# 

if ($#argv == 1) then
  set version=$1
  echo "Building ~/petscnt$version.tar.gz"
else
  set version=""
endif

/bin/rm -r -f /sandbox/petsc/tmp/petscnt
/bin/rm -f /sandbox/petsc/tmp/petscnt.tar
setenv PETSC_DIR /home/bsmith/petsc
cd /home/bsmith/petsc
make ACTION=clean tree

cd /home/bsmith
tar cFFXf /home/bsmith/petsc/maint/xclude /sandbox/petsc/tmp/petscnt.tar petsc

#
#   Gets the C version of BLAS and LAPACK (these are excluded by the 
#   regular PETSc distribution hence we need to tar them up seperately
#
cd /home/bsmith/petsc/src
tar cFFXf /home/bsmith/petsc/maint/xcludecblas /sandbox/petsc/tmp/cblas.tar blaslapack


mkdir /sandbox/petsc/tmp/petscnt
cd /sandbox/petsc/tmp/petscnt
tar xf /sandbox/petsc/tmp/petscnt.tar

cd /sandbox/petsc/tmp/petscnt/petsc/src
tar xf /sandbox/petsc/tmp/cblas.tar

cd /sandbox/petsc/tmp/petscnt/petsc
/bin/rm -rf bin
find /sandbox/petsc/tmp/petscnt -type d -name output -exec /bin/rm -rf {} \;
/bin/rm -rf bmake/alpha* bmake/sun4* bmake/solaris* bmake/hpux 
/bin/rm -rf bmake/paragon bmake/rs6000* bmake/freebsd* bmake/linux 
/bin/rm -rf bmake/nt_gnu bmake/t3d bmake/t3e bmake/IRIX* bmake/i386*
/bin/rm -f  bmake/common. bmake/common
/bin/rm -rf src/blaslapack/examples

#
# Build the tag files
#
cd /sandbox/petsc/tmp/petscnt/petsc
make etags etags_examples TAGSDIR=`pwd`
/bin/cp -f bmake/win32/makefile.dos makefile

cd /sandbox/petsc/tmp/petscnt
chmod -R u+w petsc
/home/bsmith/petsc/maint/makecpp.tcl /sandbox/petsc/tmp/petscnt/petsc

/bin/rm -f /sandbox/petsc/tmp/petscnt.tar /sandbox/petsc/tmp/cblas.tar


cd /sandbox/petsc/tmp/petscnt
if ($#argv == 1) then
  mv petsc petsc$version
endif

tar cf /sandbox/petsc/tmp/petscnt$version.tar petsc$version
cd ~/
/bin/rm -r -f /sandbox/petsc/tmp/petscnt

gzip -f /sandbox/petsc/tmp/petscnt$version.tar
/bin/cp /sandbox/petsc/tmp/petscnt$version.tar.gz ~/
chmod ug+w ~/petscnt$version.tar.gz 
/bin/rm -f /sandbox/petsc/tmp/petscnt$version.tar.gz
