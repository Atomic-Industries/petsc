#! /bin/sh
# $Id: fixinclude,v 1.1 2001/03/22 16:47:32 bsmith Exp bsmith $ 
# 
# Used by bmake/common rule html to replace #includes in the source files with links when possible
#
#
filename=$1
ROOT=$2
PETSC_DIR=$3
while [ 1 -ne 0 ]; do
  read line 
  if [ $? -ne 0 ] ; then break; fi

  r=`echo $line | egrep include`
  if [ "$?" = 0 ]; then \
    includename=`echo $line | sed -e 's?#include [ ]*</font><font color=\"#666666\">\"\([a-z./]*\)\"</font>?\1?g' -e 's?<a name="line[0-9]*">[ 0-9]*: </a><font color="#A020F0">??g' -e 's?<font color="#A020F0">[ ]*</font><font color="#B22222">[/*a-z.I "]*</font><font color="#A020F0"></font>??g' -e 's?<font color="#A020F0">[ ]*</font>??g'` 
    linenumber=`echo $line | sed 's?\(<a name="line[0-9]*">[ 0-9]*: </a>\)[.# =0-9><"a-z/A-Z:*]*?\1?g'` 
    if [ -f "$includename" ] ; then
      echo "${linenumber} #include <A href=\"${includename}.html\">${includename}</A>"  
    elif [ -f "${ROOT}/include/${includename}" ] ; then
      echo "${linenumber} #include <A href=\"${ROOT}/include/${includename}.html\">${includename}</A>" h2 ${ROOT}
    elif [ -f "${ROOT}/${includename}" ] ; then
      echo "${linenumber} #include <A href=\"${ROOT}/${includename}.html\">${includename}</A>"
    else
      echo "$line"
    fi
  else
    echo "$line"
  fi
done

