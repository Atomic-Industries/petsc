#!/bin/csh
# $Id: buildbackup,v 1.6 1997/09/10 19:39:54 balay Exp balay $ 

# 
#  Makes a complete backup of PETSc src incase the PETSc disk is lost
#
#
set BACKUPFILE=/ccsthome/petsc/userbackups/PetscBackup-`date '+%a'`.tar
set LOGFILE=/ccsthome/petsc/userbackups/PetscBackup-`date '+%a'`.log
set XCLUDEFILE=/home/bsmith/petsc/maint/xcludebackup
set ZIPFILE=PetscBackup-`date '+%a'`.tar.gz
#
date  >& $LOGFILE
cd /home/bsmith/petsc
#make ACTION=clean tree
cd /home/bsmith/petsc/docs/tex
#make clean
#
# Delete the old backup files
#
find /ccsthome/petsc/userbackups -type f -name "PetscBackup-*" -mtime +2 -exec ls -l {} \; -exec rm -f {} \; >>& $LOGFILE
#
# Create a new backup file
#
cd /home/bsmith
tar cFFXf $XCLUDEFILE $BACKUPFILE petsc >>& $LOGFILE
cd /ccsthome/petsc/userbackups
gzip $BACKUPFILE >>& $LOGFILE
#
# Now Copy the backup file over to hsm
#
cp $BACKUPFILE.gz /hsm/mcs/petsc/userbackups >>& $LOGFILE
#
# Now Copy the backup file over to a remote site
#
cd /ccsthome/petsc/userbackups
autoftp  mss.ncsa.uiuc.edu barrys  put $ZIPFILE.gz >>& $LOGFILE
date  >>& $LOGFILE
#

