#! /bin/csh
#
# Add the individual links for the PETSc shadow directory.  This script
# should be called from buildlinks.
#
#can be invoked independently as:
#addlinks /home/balay/petsc/ ./bmake/sun4_local 
#(to addlinks in /home/balay/petsc/bmake/sun4_local)
#
set shadowdir=$1
set petscdir=$2
set petscdir=`echo $petscdir | sed s%.%/home/bsmith/petsc%`
set shadowdir=`echo $petscdir | sed s%/home/bsmith/petsc%$shadowdir%`

if (! -e $shadowdir) then
  echo "mkdir $shadowdir"
  mkdir $shadowdir
  chgrp pdetools $shadowdir
  chmod g+ws $shadowdir
endif

set allfiles=$petscdir/*
foreach file ($allfiles)
  set short=`echo $file | sed s%$petscdir/%$shadowdir/%` 
  if (! -e $short && -f $file ) then
    set omit=0
    foreach bad ("\.a" "\.o" "^PI" "\.ln" "l\.outa" "mputil.mp_" "core"\
                 "\.map" "\.log" "gmon\.out" "trashz" "\.tmp" "\.b" "\~"\
                  "\#")
      set dummy=`echo $file | grep $bad` 
      if ($dummy == $file) then
        set dummy=`echo $file | grep -v "\.out"` 
        if ($dummy == $file) then
#         echo "rejecting $file due to" $bad
          set omit=1
        endif
      endif
    end
    if ($omit) continue
#   echo "ln -s $file $short"
    ln -s $file $short
  endif
end
