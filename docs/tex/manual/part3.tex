
\chapter{Advanced Options}

This section discusses options and routines that apply to all TAO
solvers and problem classes.  In particular, we focus on
convergence tests and line searches.



\section{Convergence Tests}
\label{sec:Taoconvergence}

There are many different ways to define convergence of a solver.
The methods TAO uses by default are mentioned in 
Section \ref{sec:customize}.
These methods include absolute and relative convergence tolerances as well
as a maximum number of iterations of function evaluations.
If these choices are not sufficient, 
the user can even specify a customized test\sindex{convergence tests}. 

Users can set their own customized convergence tests of the form
\begin{verbatim}
   PetscErrorCode  conv(TaoSolver tao, void *cctx);
\end{verbatim}
\noindent
The second argument
is a pointer to a structure defined by the user.
Within this routine, the solver
can be queried for the solution vector, gradient vector,
or other statistic at the current iteration through routines such as
{\tt TaoGetSolutionStatus()} and  {\tt TaoGetTolerances()}.

To use this convergence test within a TAO solver, use
the command \findex{TaoSetConvergenceTest()}
\begin{verbatim}
   TaoSetConvergenceTest(TaoSolver tao,
                     PetscErrorCode (*conv)(TaoSolver,void*),
                     void *cctx);
\end{verbatim}
\noindent
The second argument of this command is the convergence routine, and the
final argument of the convergence test routine, {\tt cctx},
denotes an optional user-defined context for private data.  
The convergence routine receives the TAO solver and this private data
structure. 
The termination flag can be set using the routine
\begin{verbatim}
   TaoSetTerminationReason(TaoSolver, TaoSolverTerminationReason);
\end{verbatim}
\noindent



\section{Line Searches} \sindex{line search}
\label{sec:TaoLineSearch}

Many solvers in TAO require a line search.  While these solvers always
offer a default line search, alternative line searches can also be used
using the function
\begin{verbatim}
   TaoSetDefaultLineSearchType(TaoSolver, LineSearchType);
\end{verbatim}
or by using the command line option  {\tt -tao\_ls\_type}.  
Available line searches 
include Mor\'{e}-Thuente\cite{more:92}, Armijo, gpcg, and unit.

The line search routines involve several parameters, which are set
to defaults that are reasonable for many applications.  The user
can override the defaults by using the following options:
\begin{itemize}
\item {\tt -tao\_ls\_maxfev <max>}
\item {\tt -tao\_ls\_stepmin <min>}
\item {\tt -tao\_ls\_stepmax <max>}
\item {\tt -tao\_ls\_ftol <ftol>}
\item {\tt -tao\_ls\_gtol <gtol>}
\item {\tt -tao\_ls\_rtol <rtol>}
\end{itemize}

One should run a TAO program with the option 
{\tt -help}
for details.  Users may write their own customized line search codes
by modeling them after one of the defaults provided.

